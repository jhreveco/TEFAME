<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of PatronDeCargasDinamico</title>
  <meta name="keywords" content="PatronDeCargasDinamico">
  <meta name="description" content="______________________________________________________________________">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # tefame --><!-- # modelo --><!-- ../menu.html cargas --><!-- menu.html patrones -->
<h1>PatronDeCargasDinamico
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>______________________________________________________________________</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> ______________________________________________________________________
|                                                                      |
|           TEFAME - Toolbox para Elementos Finitos y Analisis         |
|                  Matricial de Estructuras en MATLAB                  |
|                                                                      |
|                   Area  de Estructuras y Geotecnia                   |
|                   Departamento de Ingenieria Civil                   |
|              Facultad de Ciencias Fisicas y Matematicas              |
|                         Universidad de Chile                         |
|                                                                      |
| TEFAME es una  plataforma en base a objetos para modelar, analizar y |
| visualizar  la respuesta de sistemas  estructurales usando el metodo |
| de elementos finitos y analisis matricial de estructuras en MATLAB.  |
| La plataforma es desarrollada en  propagacion orientada a objetos en |
| MATLAB.                                                              |
|                                                                      |
| Desarrollado por:                                                    |
|       Fabian Rojas, PhD (frojas@ing.uchile.cl)                       |
|       Prof. Asistente, Departamento de Ingenieria Civil              |
|       Universidad de Chile                                           |
|______________________________________________________________________|
 ______________________________________________________________________
|                                                                      |
| Clase PatronDeCargasDinamico                                         |
|                                                                      |
| Este archivo contiene la definicion de la Clase                      |
| PatronDeCargasDinamico.                                              |
| PatronDeCargasDinamico es una subclase de la clase PatronDeCargas y  |
| corresponde  a la  representacion de un  patron de  cargas dinamico  |
| en  el   metodo  de   elementos  finitos  o  analisis  matricial  de |
| estructuras.                                                         |
| La clase PatronDeCargasDinamico  es una clase contenedor que guarda  |
| y controla las cargas que son de caracter dinamico, los que se calcu |
| lan usando el metodo de newmark.                                     |
|                                                                      |
| Programado: Pablo Pizarro @ppizarror.com                             |
| Fecha: 10/04/2019                                                    |
|______________________________________________________________________|

  Properties (Access=private):
       analisisObj
       desModal
  Methods:
       patronDeCargasObj = PatronDeCargasDinamico(etiquetaPatronDeCargas,arregloCargas,analisisObj)
       aplicarCargas(patronDeCargasObj,cpenzien,disipadores,cargaDisipador,betaObjetivo,
           arregloDisipadores,iterDisipador,tolIterDisipador,betaGrafico)
       disp(patronDeCargasObj)
  Methods SuperClass (PatronDeCargas):
       cargas = obtenerCargas(patronDeCargasObj)
  Methods SuperClass (ComponenteModelo):
       etiqueta = obtenerEtiqueta(componenteModeloObj)
       e = equals(componenteModeloObj,obj)
       objID = obtenerIDObjeto(componenteModeloObj)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="../../../../tefame/lib/drawVyLine.html" class="code" title="function obj = drawVyLine(y, style, lw)">drawVyLine</a>	DRAW VX LINE</li><li><a href="../../../../tefame/lib/equalMatrixSize.html" class="code" title="function y = equalMatrixSize(m, n)">equalMatrixSize</a>	EQUALMATRIXSIZE Chequea que dos matrices tengan el mismo largo</li><li><a href="../../../../tefame/lib/getClassnameCell.html" class="code" title="function c = getClassnameCell(a)">getClassnameCell</a>	getClassnameCell: Returns cell containing the classes in cell and the</li><li><a href="../../../../tefame/modelo/base/ComponenteModelo.html" class="code" title="">ComponenteModelo</a>	______________________________________________________________________</li><li><a href="PatronDeCargas.html" class="code" title="">PatronDeCargas</a>	______________________________________________________________________</li><li><a href="PatronDeCargasDinamico.html" class="code" title="">PatronDeCargasDinamico</a>	______________________________________________________________________</li><li><a href="../../../../tefame/utils/dispMetodoTEFAME.html" class="code" title="function dispMetodoTEFAME()">dispMetodoTEFAME</a>	dispMetodoTEFAME: Normaliza la salida estandar disp en consola de los</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="PatronDeCargasDinamico.html" class="code" title="">PatronDeCargasDinamico</a>	______________________________________________________________________</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function patronDeCargasObj = PatronDeCargasDinamico(etiquetaPatronDeCargas,</a></li><li><a href="#_sub2" class="code">function aplicarCargas(patronDeCargasObj, cpenzien, disipadores, cargaDisipador,</a></li><li><a href="#_sub3" class="code">function disp(patronDeCargasObj)</a></li><li><a href="#_sub4" class="code">function beta = calcularBetaModelo(patronDeCargasObj, cpenzien, phi1, w1)</a></li><li><a href="#_sub5" class="code">function calcularCargaGenerica(patronDeCargasObj, cpenzien, disipadores,</a></li><li><a href="#_sub6" class="code">function [x, v, z] = newmark(patronDeCargasObj, k, m, minv, c, p, dt, xo, vo)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% ______________________________________________________________________</span>
0002 <span class="comment">%|                                                                      |</span>
0003 <span class="comment">%|           TEFAME - Toolbox para Elementos Finitos y Analisis         |</span>
0004 <span class="comment">%|                  Matricial de Estructuras en MATLAB                  |</span>
0005 <span class="comment">%|                                                                      |</span>
0006 <span class="comment">%|                   Area  de Estructuras y Geotecnia                   |</span>
0007 <span class="comment">%|                   Departamento de Ingenieria Civil                   |</span>
0008 <span class="comment">%|              Facultad de Ciencias Fisicas y Matematicas              |</span>
0009 <span class="comment">%|                         Universidad de Chile                         |</span>
0010 <span class="comment">%|                                                                      |</span>
0011 <span class="comment">%| TEFAME es una  plataforma en base a objetos para modelar, analizar y |</span>
0012 <span class="comment">%| visualizar  la respuesta de sistemas  estructurales usando el metodo |</span>
0013 <span class="comment">%| de elementos finitos y analisis matricial de estructuras en MATLAB.  |</span>
0014 <span class="comment">%| La plataforma es desarrollada en  propagacion orientada a objetos en |</span>
0015 <span class="comment">%| MATLAB.                                                              |</span>
0016 <span class="comment">%|                                                                      |</span>
0017 <span class="comment">%| Desarrollado por:                                                    |</span>
0018 <span class="comment">%|       Fabian Rojas, PhD (frojas@ing.uchile.cl)                       |</span>
0019 <span class="comment">%|       Prof. Asistente, Departamento de Ingenieria Civil              |</span>
0020 <span class="comment">%|       Universidad de Chile                                           |</span>
0021 <span class="comment">%|______________________________________________________________________|</span>
0022 <span class="comment">% ______________________________________________________________________</span>
0023 <span class="comment">%|                                                                      |</span>
0024 <span class="comment">%| Clase PatronDeCargasDinamico                                         |</span>
0025 <span class="comment">%|                                                                      |</span>
0026 <span class="comment">%| Este archivo contiene la definicion de la Clase                      |</span>
0027 <span class="comment">%| PatronDeCargasDinamico.                                              |</span>
0028 <span class="comment">%| PatronDeCargasDinamico es una subclase de la clase PatronDeCargas y  |</span>
0029 <span class="comment">%| corresponde  a la  representacion de un  patron de  cargas dinamico  |</span>
0030 <span class="comment">%| en  el   metodo  de   elementos  finitos  o  analisis  matricial  de |</span>
0031 <span class="comment">%| estructuras.                                                         |</span>
0032 <span class="comment">%| La clase PatronDeCargasDinamico  es una clase contenedor que guarda  |</span>
0033 <span class="comment">%| y controla las cargas que son de caracter dinamico, los que se calcu |</span>
0034 <span class="comment">%| lan usando el metodo de newmark.                                     |</span>
0035 <span class="comment">%|                                                                      |</span>
0036 <span class="comment">%| Programado: Pablo Pizarro @ppizarror.com                             |</span>
0037 <span class="comment">%| Fecha: 10/04/2019                                                    |</span>
0038 <span class="comment">%|______________________________________________________________________|</span>
0039 <span class="comment">%</span>
0040 <span class="comment">%  Properties (Access=private):</span>
0041 <span class="comment">%       analisisObj</span>
0042 <span class="comment">%       desModal</span>
0043 <span class="comment">%  Methods:</span>
0044 <span class="comment">%       patronDeCargasObj = PatronDeCargasDinamico(etiquetaPatronDeCargas,arregloCargas,analisisObj)</span>
0045 <span class="comment">%       aplicarCargas(patronDeCargasObj,cpenzien,disipadores,cargaDisipador,betaObjetivo,</span>
0046 <span class="comment">%           arregloDisipadores,iterDisipador,tolIterDisipador,betaGrafico)</span>
0047 <span class="comment">%       disp(patronDeCargasObj)</span>
0048 <span class="comment">%  Methods SuperClass (PatronDeCargas):</span>
0049 <span class="comment">%       cargas = obtenerCargas(patronDeCargasObj)</span>
0050 <span class="comment">%  Methods SuperClass (ComponenteModelo):</span>
0051 <span class="comment">%       etiqueta = obtenerEtiqueta(componenteModeloObj)</span>
0052 <span class="comment">%       e = equals(componenteModeloObj,obj)</span>
0053 <span class="comment">%       objID = obtenerIDObjeto(componenteModeloObj)</span>
0054 
0055 classdef <a href="PatronDeCargasDinamico.html" class="code" title="">PatronDeCargasDinamico</a> &lt; <a href="PatronDeCargas.html" class="code" title="">PatronDeCargas</a>
0056     
0057     properties(Access = private)
0058         analisisObj <span class="comment">% Guarda el objeto de analisis con tal de obtener M, K, C y el vector de influencia</span>
0059         desModal <span class="comment">% Realiza descomposicion modal</span>
0060     <span class="keyword">end</span> <span class="comment">% properties PatronDeCargasDinamico</span>
0061     
0062     methods(Access = public)
0063         
0064         <a name="_sub0" href="#_subfunctions" class="code">function patronDeCargasObj = PatronDeCargasDinamico(etiquetaPatronDeCargas, </a><span class="keyword">...</span>
0065                 arregloCargas, analisisObj, varargin)
0066             <span class="comment">% PatronDeCargasDinamico: es el constructor de la clase PatronDeCargas</span>
0067             <span class="comment">%</span>
0068             <span class="comment">% patronDeCargasObj = PatronDeCargasDinamico(etiquetaPatronDeCargas,arregloCargas,analisisObj,varargin)</span>
0069             <span class="comment">%</span>
0070             <span class="comment">% Parametros opcionales:</span>
0071             <span class="comment">%   'desmodal'  Ejecuta la condensacion modal</span>
0072             <span class="comment">%</span>
0073             <span class="comment">% Crea un objeto de la clase PatronDeCargas, con un identificador unico</span>
0074             <span class="comment">% (etiquetaPatronDeCargas) y guarda el arreglo con las cargas (arregloCargas)</span>
0075             <span class="comment">% a aplicar en el modelo</span>
0076             
0077             <span class="comment">% Si no se pasan argumentos se crean vacios</span>
0078             <span class="keyword">if</span> nargin == 0
0079                 etiquetaPatronDeCargas = <span class="string">''</span>;
0080             <span class="keyword">end</span> <span class="comment">% if</span>
0081             
0082             <span class="comment">% Llamamos al constructor de la SuperClass que es la clase ComponenteModelo</span>
0083             patronDeCargasObj = patronDeCargasObj@<a href="PatronDeCargas.html" class="code" title="">PatronDeCargas</a>(etiquetaPatronDeCargas);
0084             
0085             <span class="comment">% Obtiene parametros opcionales</span>
0086             p = inputParser;
0087             p.KeepUnmatched = true;
0088             addOptional(p, <span class="string">'desmodal'</span>, true);
0089             parse(p, varargin{:});
0090             r = p.Results;
0091             
0092             <span class="comment">% Se guarda el arreglo con las cargas</span>
0093             patronDeCargasObj.cargas = arregloCargas;
0094             
0095             <span class="comment">% Define propiedades</span>
0096             patronDeCargasObj.patronEsDinamico = true;
0097             
0098             <span class="comment">% Guarda el analisis</span>
0099             patronDeCargasObj.analisisObj = analisisObj;
0100             
0101             <span class="comment">% Descomposicion modal</span>
0102             patronDeCargasObj.desModal = r.desmodal;
0103             
0104         <span class="keyword">end</span> <span class="comment">% PatronDeCargasDinamico constructor</span>
0105         
0106         <a name="_sub1" href="#_subfunctions" class="code">function aplicarCargas(patronDeCargasObj, cpenzien, disipadores, cargaDisipador, </a><span class="keyword">...</span>
0107                 betaObjetivo, arregloDisipadores, iterDisipador, tolIterDisipador, <span class="keyword">...</span>
0108                 betaGrafico, factor)
0109             <span class="comment">% aplicarCargas: es un metodo de la clase PatronDeCargasDinamico que</span>
0110             <span class="comment">% se usa para aplicar las cargas guardadas en el Patron de Cargas</span>
0111             <span class="comment">%</span>
0112             <span class="comment">% aplicarCargas(patronDeCargasObj,cpenzien,disipadores,cargaDisipador,betaObjetivo,</span>
0113             <span class="comment">%   arregloDisipadores,iterDisipador,tolIterDisipador,betaGrafico,factor)</span>
0114             <span class="comment">%</span>
0115             <span class="comment">% Aplica las cargas que estan guardadas en el PatronDeCargasDinamico</span>
0116             <span class="comment">% (patronDeCargasObj), es decir, se aplican las cargas sobre los nodos</span>
0117             <span class="comment">% y elementos</span>
0118             
0119             <span class="keyword">if</span> disipadores
0120                 
0121                 <span class="comment">% Inicio del proceso de iteracion</span>
0122                 tinicio = cputime;
0123                 tcalculo = 0;
0124                 
0125                 <span class="comment">% Genera lista de disipadores del modelo</span>
0126                 disipadorNombres = <a href="../../../../tefame/lib/getClassnameCell.html" class="code" title="function c = getClassnameCell(a)">getClassnameCell</a>(arregloDisipadores);
0127                 disipadorNombresK = disipadorNombres.keys();
0128                 disipadorNombresC = disipadorNombres.values();
0129                 totalDisipador = length(arregloDisipadores);
0130                 fprintf(<span class="string">'\tDisipadores del modelo: %d\n'</span>, totalDisipador);
0131                 <span class="keyword">for</span> i = 1:length(disipadorNombresK)
0132                     fprintf(<span class="string">'\t\t%d %s\n'</span>, disipadorNombresC{i}, disipadorNombresK{i});
0133                 <span class="keyword">end</span> <span class="comment">% for i</span>
0134                 
0135                 <span class="comment">% Se busca el indice de la carga objetivo</span>
0136                 totalCargas = length(patronDeCargasObj.cargas);
0137                 indiceCargaObjetivo = 0; <span class="comment">% Indica si se usa una carga especifica para el calculo de v0 del disipador</span>
0138                 <span class="keyword">for</span> i = 1:totalCargas
0139                     <span class="keyword">if</span> cargaDisipador.equals(patronDeCargasObj.cargas{i})
0140                         <span class="keyword">if</span> ~patronDeCargasObj.cargas{i}.cargaActivada()
0141                             error(<span class="string">'La carga objetivo del disipador esta desactivada'</span>);
0142                         <span class="keyword">end</span>
0143                         cargaDisipadorObj = patronDeCargasObj.cargas{i};
0144                         fprintf(<span class="string">'\tSe calculan los disipadores usando la carga %s\n'</span>, cargaDisipadorObj.obtenerEtiqueta);
0145                         indiceCargaObjetivo = i;
0146                         <span class="keyword">break</span>;
0147                     <span class="keyword">end</span>
0148                 <span class="keyword">end</span> <span class="comment">% for i</span>
0149                 <span class="keyword">if</span> indiceCargaObjetivo == 0
0150                     error(<span class="string">'La carga objetivo del disipador no existe en el patron de cargas'</span>);
0151                 <span class="keyword">end</span>
0152                 
0153                 <span class="comment">% Calcula beta inicial del modelo</span>
0154                 fprintf(<span class="string">'\t\tCalculando amortiguamiento inicial del modelo sin los disipadores actualizados\n'</span>);
0155                 
0156                 <span class="comment">% Al realizar esto el nuevo desplazamiento se guarda en la</span>
0157                 <span class="comment">% carga</span>
0158                 patronDeCargasObj.calcularCargaGenerica(cpenzien, <span class="keyword">...</span>
0159                     false, indiceCargaObjetivo, true, 0, <span class="keyword">...</span>
0160                     factor); <span class="comment">% No uso disipadores</span>
0161                 
0162                 <span class="comment">% Calcula w asociado al modo que mueve mas energia</span>
0163                 w = patronDeCargasObj.analisisObj.calcularModosEnergia(cargaDisipadorObj, false);
0164                 w1 = w(1, 2);
0165                 nmodo1 = w(1, 1);
0166                 fprintf(<span class="string">'\t\tPara la carga objetivo el modo que mueve mas energia (%.1f%%) es el %d, w: %.2frad/s\n'</span>, <span class="keyword">...</span>
0167                     w(1, 5)*100, w(1, 1), w(1, 2));
0168                 
0169                 <span class="comment">% Se realiza iteracion</span>
0170                 iterDisipador = floor(iterDisipador);
0171                 <span class="keyword">if</span> iterDisipador &gt; 0
0172                     
0173                     <span class="comment">% Output</span>
0174                     fprintf(<span class="string">'\tParametros iteracion:\n\t\titerDisipador: %d\n\t\ttolIterDisipador: %.3f\n\t\tbetaObjetivo: %.3f\n'</span>, <span class="keyword">...</span>
0175                         iterDisipador, tolIterDisipador, betaObjetivo);
0176                     fprintf(<span class="string">'\tIniciando iteraciones\n'</span>);
0177                     
0178                     <span class="comment">% Variables que guardan los estados de beta</span>
0179                     vo_i = zeros(1, length(arregloDisipadores));
0180                     vo_ii = zeros(1, length(arregloDisipadores));
0181                     
0182                     <span class="comment">% Beta del grafico</span>
0183                     betagr_b = [];
0184                     betagr_i = 0;
0185                     
0186                     <span class="comment">% Calcula beta sin actualizar disipadores</span>
0187                     beta = patronDeCargasObj.calcularBetaModelo(cpenzien, nmodo1, w1);
0188                     betagr_i = betagr_i + 1; <span class="comment">% Guarda en el arreglo</span>
0189                     betagr_b(betagr_i) = beta;
0190                     fprintf(<span class="string">'\t\tAmortiguamiento inicial: %.4f\n'</span>, beta);
0191                     
0192                     <span class="comment">% Actualiza el disipador</span>
0193                     fprintf(<span class="string">'\t\tIteracion 1:\n'</span>);
0194                     fprintf(<span class="string">'\t\t\tActualizando disipadores\n'</span>);
0195                     <span class="keyword">for</span> i = 1:totalDisipador
0196                         arregloDisipadores{i}.actualizarDisipador(w1, cargaDisipadorObj);
0197                         nodos = arregloDisipadores{i}.obtenerNodos();
0198                         vo_i(i) = arregloDisipadores{i}.calcularv0(nodos, cargaDisipadorObj);
0199                     <span class="keyword">end</span> <span class="comment">% for i</span>
0200                     beta = patronDeCargasObj.calcularBetaModelo(cpenzien, nmodo1, w1);
0201                     fprintf(<span class="string">'\t\t\tbeta: %.4f\n'</span>, beta);
0202                     betagr_i = betagr_i + 1; <span class="comment">% Guarda en el arreglo</span>
0203                     betagr_b(betagr_i) = beta;
0204                     <span class="comment">% betaAnt = beta; % Guarda el beta anterior</span>
0205                     pause(0.1);
0206                     
0207                     <span class="comment">% Realiza las iteraciones</span>
0208                     <span class="keyword">for</span> j = 2:(iterDisipador - 1)
0209                         
0210                         <span class="comment">% Calcula la carga</span>
0211                         fprintf(<span class="string">'\t\tIteracion %d:\n'</span>, j);
0212                         patronDeCargasObj.calcularCargaGenerica(cpenzien, <span class="keyword">...</span>
0213                             true, indiceCargaObjetivo, true, 0, factor);
0214                         
0215                         <span class="comment">% Actualiza los disipadores</span>
0216                         fprintf(<span class="string">'\t\t\tActualizando disipadores\n'</span>);
0217                         <span class="keyword">for</span> i = 1:totalDisipador
0218                             arregloDisipadores{i}.actualizarDisipador(w1, cargaDisipadorObj);
0219                             nodos = arregloDisipadores{i}.obtenerNodos();
0220                             vo_ii(i) = arregloDisipadores{i}.calcularv0(nodos, cargaDisipadorObj);
0221                         <span class="keyword">end</span> <span class="comment">% for i</span>
0222                         
0223                         <span class="comment">% Calcula beta</span>
0224                         beta = patronDeCargasObj.calcularBetaModelo(cpenzien, nmodo1, w1);
0225                         fprintf(<span class="string">'\t\t\tbeta: %.4f\n'</span>, beta);
0226                         betagr_i = betagr_i + 1; <span class="comment">% Guarda en el arreglo</span>
0227                         betagr_b(betagr_i) = beta;
0228                         
0229                         delta_vo = abs(vo_i-vo_ii);
0230                         tol_i = max(delta_vo);
0231                         fprintf(<span class="string">'\t\t\tdelta: %.4f\n'</span>, tol_i);
0232                         <span class="keyword">if</span> tol_i &lt;= tolIterDisipador
0233                             fprintf(<span class="string">'\t\t\tSe ha logrado la convergencia del modelo con disipadores\n'</span>);
0234                             <span class="keyword">if</span> betaObjetivo &gt; 0
0235                                 betaSign = <span class="string">''</span>;
0236                                 <span class="keyword">if</span> beta &gt;= betaObjetivo
0237                                     fprintf(<span class="string">'\t\t\tSe ha logrado el amortiguamiento objetivo\n'</span>);
0238                                     betaSign = <span class="string">'+'</span>;
0239                                 <span class="keyword">else</span>
0240                                     fprintf(<span class="string">'\t\t\tNo se ha logrado el amortiguamiento objetivo\n'</span>);
0241                                 <span class="keyword">end</span>
0242                                 fprintf(<span class="string">'\t\t\t\tDiferencia: %s%.1f%%\n'</span>, <span class="keyword">...</span>
0243                                     betaSign, (beta - betaObjetivo)/betaObjetivo*100);
0244                             <span class="keyword">end</span>
0245                             <span class="keyword">break</span>;
0246                         <span class="keyword">elseif</span> j == iterDisipador &amp;&amp; tol_i &gt; tolIterDisipador
0247                             fprintf(<span class="string">'\t\t\tNo se ha logrado la convergencia del modelo con disipadores\n'</span>);
0248                             fprintf(<span class="string">'\t\t\tSe debe aumentar el numero de iteraciones\n'</span>);
0249                         <span class="keyword">end</span>
0250                         vo_i = vo_ii;
0251                         
0252                         <span class="comment">% Guarda el beta anterior</span>
0253                         <span class="comment">% betaAnt = beta;</span>
0254                         
0255                     <span class="keyword">end</span> <span class="comment">% for j</span>
0256                     tcalculo = cputime - tinicio;
0257                     fprintf(<span class="string">'\t\tProceso calculo disipador finalizado en %.3f segundos\n'</span>, tcalculo);
0258                     
0259                     <span class="comment">% Con los disipadores calcula todas las cargas</span>
0260                     fprintf(<span class="string">'\tAmortiguamiento del modelo: %.3f\n'</span>, beta);
0261                     fprintf(<span class="string">'\tInicio calculo de cargas con los disipadores actualizados\n'</span>);
0262                     
0263                     <span class="comment">% Grafica si aplica</span>
0264                     <span class="keyword">if</span> betaGrafico
0265                         fig_title = <span class="string">'Variacion amortiguamiento iteraciones'</span>;
0266                         plt = figure(<span class="string">'Name'</span>, fig_title, <span class="string">'NumberTitle'</span>, <span class="string">'off'</span>);
0267                         movegui(plt, <span class="string">'center'</span>);
0268                         betaxticks = 0:1:(betagr_i - 1);
0269                         plot(betaxticks, betagr_b, <span class="string">'-'</span>, <span class="string">'LineWidth'</span>, 1.4, <span class="string">'Color'</span>, <span class="string">'black'</span>);
0270                         <span class="comment">% grid on;</span>
0271                         xlabel(<span class="string">'Numero iteracion'</span>);
0272                         ylabel(<span class="string">'Amortiguamiento'</span>);
0273                         title(fig_title);
0274                         set(gca, <span class="string">'XTick'</span>, betaxticks);
0275                         <span class="keyword">if</span> betaObjetivo &gt; 0
0276                             hold on;
0277                             <a href="../../../../tefame/lib/drawVyLine.html" class="code" title="function obj = drawVyLine(y, style, lw)">drawVyLine</a>(betaObjetivo, <span class="string">'b--'</span>, 1.2);
0278                             legend({<span class="string">'Variacion amortiguamiento'</span>, sprintf(<span class="string">'Amortiguamiento objetivo: %.3f'</span>, <span class="keyword">...</span>
0279                                 betaObjetivo)}, <span class="string">'location'</span>, <span class="string">'southeast'</span>);
0280                         <span class="keyword">end</span>
0281                         drawnow();
0282                         pause(0.1);
0283                     <span class="keyword">end</span>
0284                     
0285                 <span class="keyword">else</span>
0286                     
0287                     <span class="comment">% No se iteran los disipadores</span>
0288                     beta = patronDeCargasObj.calcularBetaModelo(cpenzien, nmodo1, w1);
0289                     fprintf(<span class="string">'\tNo se realizo el proceso de iteracion de los disipadores\n'</span>);
0290                     fprintf(<span class="string">'\tAmortiguamiento del modelo: %.3f\n'</span>, beta);
0291                     fprintf(<span class="string">'\tInicio calculo de cargas con los disipadores sin actualizar\n'</span>);
0292                     
0293                 <span class="keyword">end</span>
0294                 
0295                 <span class="comment">% Calcula todas las cargas con los disipadores actualizados</span>
0296                 patronDeCargasObj.calcularCargaGenerica(cpenzien, true, 0, <span class="keyword">...</span>
0297                     false, tcalculo, factor);
0298                 
0299             <span class="keyword">else</span>
0300                 
0301                 <span class="comment">% Calcula todas las cargas sin usar disipadores</span>
0302                 patronDeCargasObj.calcularCargaGenerica(cpenzien, false, 0, <span class="keyword">...</span>
0303                     false, 0, factor);
0304                 
0305             <span class="keyword">end</span>
0306             
0307         <span class="keyword">end</span> <span class="comment">% aplicarCargas function</span>
0308         
0309         <a name="_sub2" href="#_subfunctions" class="code">function disp(patronDeCargasObj)</a>
0310             <span class="comment">% disp: es un metodo de la clase PatronDeCargasDinamico que se usa</span>
0311             <span class="comment">% para imprimir en el command Window la informacion del Patron de Cargas</span>
0312             <span class="comment">%</span>
0313             <span class="comment">% disp(patronDeCargasObj)</span>
0314             <span class="comment">%</span>
0315             <span class="comment">% Imprime la informacion guardada en el Patron de Cargas Dinamico</span>
0316             <span class="comment">% (patronDeCargasObj) en pantalla</span>
0317             
0318             fprintf(<span class="string">'Propiedades patron de cargas dinamico:\n'</span>);
0319             <a href="#_sub3" class="code" title="subfunction disp(patronDeCargasObj)">disp</a>@<a href="../../../../tefame/modelo/base/ComponenteModelo.html" class="code" title="">ComponenteModelo</a>(patronDeCargasObj);
0320             <a href="../../../../tefame/utils/dispMetodoTEFAME.html" class="code" title="function dispMetodoTEFAME()">dispMetodoTEFAME</a>();
0321             
0322         <span class="keyword">end</span> <span class="comment">% disp function</span>
0323         
0324     <span class="keyword">end</span> <span class="comment">% methods PatronDeCargasDinamico</span>
0325     
0326     methods(Access = private)
0327         
0328         <a name="_sub3" href="#_subfunctions" class="code">function beta = calcularBetaModelo(patronDeCargasObj, cpenzien, phi1, w1)</a>
0329             <span class="comment">% calcularBetaModelo: Calcula el amortiguamiento considerando</span>
0330             <span class="comment">% disipadores</span>
0331             <span class="comment">%</span>
0332             <span class="comment">% calcularBetaModelo(patronDeCargasObj, phi1, w1)</span>
0333             
0334             m = patronDeCargasObj.analisisObj.obtenerMatrizMasa();
0335             c = patronDeCargasObj.analisisObj.obtenerMatrizAmortiguamiento(~cpenzien);
0336             cd = patronDeCargasObj.analisisObj.obtenerMatrizAmortiguamientoDisipadores();
0337             phi = patronDeCargasObj.analisisObj.obtenerMatrizPhi();
0338             phi1 = phi(:, phi1);
0339             
0340             beta = (phi1' * (c + cd) * phi1) / (2 * w1 * phi1' * m * phi1);
0341             
0342         <span class="keyword">end</span> <span class="comment">% calcularBetaModelo function</span>
0343         
0344         <a name="_sub4" href="#_subfunctions" class="code">function calcularCargaGenerica(patronDeCargasObj, cpenzien, disipadores, </a><span class="keyword">...</span>
0345                 cargaIndiceDisipador, calculaDisipadores, tcalculoAnterior, factor)
0346             <span class="comment">% calcularCargaGenerica: Funcion que calcula el tema de las</span>
0347             <span class="comment">% cargas, es generica en cuanto al calculo. Esta puede</span>
0348             <span class="comment">% funcionar tanto si hay o no hay disipadores</span>
0349             <span class="comment">%</span>
0350             <span class="comment">% calcularCargaGenerica(patronDeCargasObj,cpenzien,disipadores,</span>
0351             <span class="comment">%   cargaIndiceDisipador,calculaDisipadores,tcalculoAnterior,</span>
0352             <span class="comment">%   factor)</span>
0353             
0354             <span class="comment">% Obtiene los parametros de la estructura</span>
0355             k = patronDeCargasObj.analisisObj.obtenerMatrizRigidez();
0356             m = patronDeCargasObj.analisisObj.obtenerMatrizMasa();
0357             c = patronDeCargasObj.analisisObj.obtenerMatrizAmortiguamiento(~cpenzien);
0358             cd = patronDeCargasObj.analisisObj.obtenerMatrizAmortiguamientoDisipadores();
0359             r = patronDeCargasObj.analisisObj.obtenerVectorInfluencia();
0360             phi = patronDeCargasObj.analisisObj.obtenerMatrizPhi();
0361             
0362             <span class="comment">% Chequea que las dimensiones sean apropiadas</span>
0363             <span class="keyword">if</span> ~<a href="../../../../tefame/lib/equalMatrixSize.html" class="code" title="function y = equalMatrixSize(m, n)">equalMatrixSize</a>(k, m) || ~<a href="../../../../tefame/lib/equalMatrixSize.html" class="code" title="function y = equalMatrixSize(m, n)">equalMatrixSize</a>(m, c) || length(r) ~= length(m)
0364                 error(<span class="string">'Tamano incorrecto de matrices K, M, C, r'</span>);
0365             <span class="keyword">end</span>
0366             
0367             <span class="comment">% Agrega o no disipadores</span>
0368             <span class="keyword">if</span> disipadores
0369                 <span class="keyword">if</span> ~calculaDisipadores
0370                     fprintf(<span class="string">'\tPatron de cargas dinamico considera el uso de disipadores\n'</span>);
0371                 <span class="keyword">end</span>
0372                 c = c + cd;
0373             <span class="keyword">else</span>
0374                 <span class="keyword">if</span> ~calculaDisipadores
0375                     fprintf(<span class="string">'\tPatron de cargas dinamico no considera el uso de disipadores\n'</span>);
0376                 <span class="keyword">end</span>
0377             <span class="keyword">end</span>
0378             
0379             <span class="comment">% Descomposicion modal</span>
0380             <span class="keyword">if</span> patronDeCargasObj.desModal
0381                 k = phi' * k * phi;
0382                 mmodal = phi' * m * phi;
0383                 c = phi' * c * phi;
0384                 <span class="keyword">if</span> ~calculaDisipadores
0385                     fprintf(<span class="string">'\tPatron de cargas usa descomposicion modal\n'</span>);
0386                 <span class="keyword">end</span>
0387             <span class="keyword">else</span>
0388                 <span class="keyword">if</span> ~calculaDisipadores
0389                     fprintf(<span class="string">'\tPatron de cargas no usa descomposicion modal\n'</span>);
0390                 <span class="keyword">end</span>
0391                 mmodal = m;
0392             <span class="keyword">end</span>
0393             
0394             <span class="keyword">if</span> cpenzien
0395                 <span class="keyword">if</span> ~calculaDisipadores
0396                     fprintf(<span class="string">'\tPatron de cargas dinamico usa amortiguamiento de Wilson-Penzien\n'</span>);
0397                 <span class="keyword">end</span>
0398             <span class="keyword">else</span>
0399                 <span class="keyword">if</span> ~calculaDisipadores
0400                     fprintf(<span class="string">'\tPatron de cargas dinamico usa amortiguamiento de Rayleigh\n'</span>);
0401                 <span class="keyword">end</span>
0402             <span class="keyword">end</span>
0403             
0404             <span class="comment">% Calcula las inversas</span>
0405             minv = mmodal^(-1);
0406             
0407             <span class="comment">% Se calcula carga una de las cargas dinamicas</span>
0408             tInicioProceso = cputime;
0409             totalCargas = length(patronDeCargasObj.cargas);
0410             usaCargaIndice = false; <span class="comment">% Indica si se usa una carga especifica para el calculo de v0 del disipador</span>
0411             <span class="keyword">for</span> i = 1:totalCargas
0412                 
0413                 <span class="comment">% Si se quiere calcular un disipador se genera el codigo</span>
0414                 <span class="comment">% con una sola carga</span>
0415                 <span class="keyword">if</span> cargaIndiceDisipador ~= 0
0416                     i = cargaIndiceDisipador; <span class="comment">%#ok&lt;FXSET&gt;</span>
0417                     usaCargaIndice = true;
0418                 <span class="keyword">end</span>
0419                 
0420                 <span class="comment">% Chequea que la carga sea dinamica</span>
0421                 <span class="keyword">if</span> ~isa(patronDeCargasObj.cargas{i}, <span class="string">'CargaDinamica'</span>)
0422                     error(<span class="string">'PatronDeCargasDinamico solo puede resolver cargas dinamicas'</span>);
0423                 <span class="keyword">end</span>
0424                 
0425                 <span class="comment">% Obtiene la carga</span>
0426                 tInicio = cputime;
0427                 <span class="keyword">if</span> ~calculaDisipadores
0428                     fprintf(<span class="string">'\t\tAplicando carga %s (%d/%d)\n'</span>, <span class="keyword">...</span>
0429                         patronDeCargasObj.cargas{i}.obtenerEtiqueta(), i, totalCargas);
0430                 <span class="keyword">end</span>
0431                 
0432                 <span class="comment">% Chequea que la carga este activa</span>
0433                 <span class="keyword">if</span> ~patronDeCargasObj.cargas{i}.cargaActivada()
0434                     fprintf(<span class="string">'\t\t\tLa carga %s esta desactivada\n'</span>, <span class="keyword">...</span>
0435                         patronDeCargasObj.cargas{i}.obtenerEtiqueta());
0436                     <span class="keyword">continue</span>;
0437                 <span class="keyword">end</span>
0438                 
0439                 <span class="comment">% Chequea que la carga no haya sido calculada</span>
0440                 <span class="keyword">if</span> patronDeCargasObj.cargas{i}.cargaCalculada() &amp;&amp; ~calculaDisipadores
0441                     fprintf(<span class="string">'\t\t\tLa carga %s ya fue calculada\n'</span>, <span class="keyword">...</span>
0442                         patronDeCargasObj.cargas{i}.obtenerEtiqueta());
0443                     <span class="keyword">continue</span>;
0444                 <span class="keyword">end</span>
0445                 
0446                 <span class="comment">% Genera las cargas</span>
0447                 <span class="keyword">if</span> ~calculaDisipadores
0448                     fprintf(<span class="string">'\t\t\tGenerando la matriz de cargas\n'</span>);
0449                 <span class="keyword">end</span>
0450                 p = patronDeCargasObj.cargas{i}.calcularCarga(factor, m, r, ~calculaDisipadores);
0451                 
0452                 <span class="comment">% Descomposicion modal</span>
0453                 <span class="keyword">if</span> patronDeCargasObj.desModal
0454                     pmodal = phi' * p;
0455                 <span class="keyword">else</span>
0456                     pmodal = p;
0457                 <span class="keyword">end</span>
0458                 
0459                 <span class="comment">% Resuelve newmark</span>
0460                 [u, du, ddu] = patronDeCargasObj.newmark(k, mmodal, minv, <span class="keyword">...</span>
0461                     c, pmodal, patronDeCargasObj.cargas{i}.dt, 0, 0);
0462                 
0463                 <span class="comment">% Aplica descomposicion si aplica</span>
0464                 <span class="keyword">if</span> patronDeCargasObj.desModal
0465                     u = phi * u;
0466                     du = phi * du;
0467                     ddu = phi * ddu;
0468                 <span class="keyword">end</span>
0469                 
0470                 <span class="comment">% Guarda los resultados</span>
0471                 patronDeCargasObj.cargas{i}.guardarCarga(p);
0472                 patronDeCargasObj.cargas{i}.guardarDesplazamiento(u);
0473                 patronDeCargasObj.cargas{i}.guardarVelocidad(du);
0474                 patronDeCargasObj.cargas{i}.guardarAceleracion(ddu);
0475                 patronDeCargasObj.cargas{i}.amortiguamientoRayleigh(~cpenzien);
0476                 patronDeCargasObj.cargas{i}.usoDisipadores(disipadores);
0477                 patronDeCargasObj.cargas{i}.descomposicionModal(patronDeCargasObj.desModal);
0478                 
0479                 <span class="keyword">if</span> ~calculaDisipadores
0480                     patronDeCargasObj.cargas{i}.establecerCargaCalculada();
0481                     fprintf(<span class="string">'\n\t\t\tSe completo calculo en %.3f segundos\n'</span>, cputime-tInicio);
0482                 <span class="keyword">end</span>
0483                 
0484                 <span class="comment">% Si ya se calculo la carga objetivo para el disipador</span>
0485                 <span class="comment">% retorna</span>
0486                 <span class="keyword">if</span> usaCargaIndice
0487                     fprintf(<span class="string">'\n'</span>);
0488                     <span class="keyword">break</span>;
0489                 <span class="keyword">end</span>
0490                 
0491             <span class="keyword">end</span> <span class="comment">% for i</span>
0492             
0493             <span class="keyword">if</span> ~calculaDisipadores
0494                 fprintf(<span class="string">'\tProceso finalizado en %.3f segundos\n'</span>, cputime-tInicioProceso+tcalculoAnterior);
0495                 <a href="../../../../tefame/utils/dispMetodoTEFAME.html" class="code" title="function dispMetodoTEFAME()">dispMetodoTEFAME</a>();
0496             <span class="keyword">end</span>
0497             
0498         <span class="keyword">end</span> <span class="comment">% calcularCargaGenerica function</span>
0499         
0500         <a name="_sub5" href="#_subfunctions" class="code">function [x, v, z] = newmark(patronDeCargasObj, k, m, minv, c, p, dt, xo, vo) </a><span class="comment">%#ok&lt;*INUSL&gt;</span>
0501             <span class="comment">% Newmark: es un metodo de la clase ModalEspectral que se</span>
0502             <span class="comment">% usa para obtener los valores de aceleracion, velociadad y desplazamiento</span>
0503             <span class="comment">% de los grados de libertad a partir del metodo de Newmark</span>
0504             <span class="comment">%</span>
0505             <span class="comment">% [x,v,z]=newmark(patronDeCargasObj,k,m,minv,c,p,dt,xo,vo)</span>
0506             
0507             <span class="comment">% Define coeficientes</span>
0508             alpha = 0;
0509             gamma = 1 / 2 - alpha;
0510             beta = 1 / 4 * (1 - alpha)^2;
0511             
0512             n = length(p);
0513             ngl = length(k);
0514             x = zeros(ngl, length(p));
0515             v = zeros(ngl, length(p));
0516             z = zeros(ngl, length(p));
0517             x(:, 1) = xo;
0518             v(:, 1) = vo;
0519             z(:, 1) = minv * (p(:, 1) - c * v(:, 1) - k * x(:, 1));
0520             c1 = 1 / (dt^2 * beta);
0521             c2 = 1 / (dt * beta);
0522             c3 = gamma / (dt * beta);
0523             c4 = 1 - gamma / beta;
0524             c5 = 1 - gamma / (2 * beta);
0525             c6 = 1 / (2 * beta) - 1;
0526             ks = c1 * m + (1 + alpha) * c3 * c + (1 + alpha) * k; <span class="comment">%hht</span>
0527             ks_inv = ks^(-1);
0528             ps = zeros(ngl, length(p));
0529             reverse_porcent = <span class="string">''</span>;
0530             
0531             <span class="keyword">for</span> i = 1:1:(n - 1)
0532                 
0533                 <span class="comment">% Calcula</span>
0534                 ps(:, i+1) = p(:, i+1) + k * alpha * x(:, i) + m * (c1 * x(:, i) + c2 * v(:, i) + c6 * z(:, i)) <span class="keyword">...</span>
0535                     +c * ((1 + alpha) * c3 * x(:, i) + (alpha - (1 + alpha) * c4) * v(:, i) - (1 + alpha) * c5 * dt * z(:, i));<span class="comment">% HHT</span>
0536                 x(:, i+1) = ks_inv * ps(:, i+1);
0537                 v(:, i+1) = (gamma / (beta * dt)) * (x(:, i+1) - x(:, i)) + (1 - gamma / beta) * v(:, i) + dt * (1 - gamma / (2 * beta)) * z(:, i);
0538                 z(:, i+1) = (1 / (beta * dt^2)) * (x(:, i+1) - x(:, i)) - (1 / (beta * dt)) * v(:, i) - (1 / (2 * beta) - 1) * z(:, i);
0539                 
0540                 <span class="comment">% Imprime estado</span>
0541                 msg = sprintf(<span class="string">'\t\t\tCalculando ... %.1f/100'</span>, i/(n - 1)*100);
0542                 fprintf([reverse_porcent, msg]);
0543                 reverse_porcent = repmat(sprintf(<span class="string">'\b'</span>), 1, length(msg));
0544                 
0545             <span class="keyword">end</span> <span class="comment">% for i</span>
0546             
0547         <span class="keyword">end</span> <span class="comment">% newmark function</span>
0548         
0549     <span class="keyword">end</span> <span class="comment">% methods PatronDeCargasDinamico</span>
0550     
0551 <span class="keyword">end</span> <span class="comment">% class PatronDeCargasDinamico</span></pre></div>
<hr><address>Generated on Wed 15-May-2019 23:09:04 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>